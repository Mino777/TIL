# TIL 220421GCD1-1

## ğŸ”¥í•™ìŠµ ë‚´ìš©

### GCD(Grand Central Dispatch)
- ë©€í‹° ì½”ì–´ í™˜ê²½ê³¼ ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ìµœì í™”ëœ í”„ë¡œê·¸ë˜ë°ì„ í•  ìˆ˜ ìˆë„ë¡ ì• í”Œì´ ì œê³µí•˜ëŠ” Low Level API
- ê°œë°œìê°€ ì§ì ‘ ì½”ì–´ì™€ ìŠ¤ë ˆë“œë¥¼ ê´€ë¦¬í•˜ì§€ ì•Šì•„ë„ ì‹œìŠ¤í…œì—ì„œ ì•Œì•„ì„œ ê´€ë¦¬ë¥¼ í•´ì¤Œ
- GCDë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ Dispatchë¼ëŠ” í”„ë ˆì„ì›Œí¬, íŠ¹íˆ Dispatch Queueë¼ëŠ” classë¥¼ ì£¼ë¡œ ì‚¬ìš©

### DispatchQueue
- ëŒ€ê¸°ì—´ì— ë³´ë‚´ë‹¤
- ê°œë°œìê°€ ì´ ëŒ€ê¸°ì—´ ë“¤ì— ì‘ì—…ì„ ì¶”ê°€í•´ì£¼ë©´ ì•Œì•„ì„œ ìŠ¤ë ˆë“œë¥¼ ê´€ë¦¬í•˜ì—¬ ì‘ì—…ì„ ì²˜ë¦¬
- Queueì´ê¸° ë•Œë¬¸ì— FIFOë¡œ ì‘ì—…ì„ ì²˜ë¦¬
- DispatchQueueì— ì‘ì—…ì„ ë„˜ê¸¸ ë•Œ ë‹¨ì¼ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í• ê±´ì§€, ë‹¤ì¤‘ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í• ê±´ì§€ì™€ ë™ê¸°ë¡œ ì²˜ë¦¬í• ê±´ì§€, ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í• ê±´ì§€ë¥¼ ì •í•´ì£¼ì–´ì•¼í•¨
- Serial/Concurrent, sync/async

### Serial / Concurrent
- Serial
	- ë‹¨ì¼ ìŠ¤ë ˆë“œì—ì„œ ì‘ì—…ì„ ì²˜ë¦¬
	- mainì˜ ê²½ìš° Serial Queue
	- attributesë¥¼ ì§€ì •í•˜ì§€ ì•Šê³  ì´ˆê¸°í™”í•˜ëŠ” ê²½ìš° Serial Queue
- Concurrent
	- ë‹¤ì¤‘ ìŠ¤ë ˆë“œì—ì„œ ì‘ì—…ì„ ì²˜ë¦¬
	- global()ì˜ ê²½ìš° Concrurrent Queue
	- attirbutesë¥¼ concurrentë¡œ ì´ˆê¸°í™” í•´ì£¼ëŠ” ê²½ìš° Concurrent Queue
```swift
// Serial Queue
DispatchQueue(label: "Serial")
DispatchQueue.main

// Concurrent Queue
DispatchQueue(label: "Concurrent", attributes: .concurrent)
DispatchQueue.global()
```

### main / global
- ì´ë¯¸ ë§Œë“¤ì–´ì ¸ìˆëŠ” í
- main
	- Serial Queue
	- main ìŠ¤ë ˆë“œì—ì„œ ì‘ì—…ì„ ì²˜ë¦¬
	- main ìŠ¤ë ˆë“œì—ì„œ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì— í•­ìƒ ë©”ëª¨ë¦¬ì— ì˜¬ë¼ì™€ ìˆê³  ì „ì—­ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥
- global
	- Concurrent Queue
	- main ìŠ¤ë ˆë“œì—ì„œ ìƒˆë¡œìš´ ìŠ¤ë ˆë“œë¥¼ íŒŒìƒì‹œì¼œ íŒŒìƒëœ ìŠ¤ë ˆë“œì—ì„œ ì‘ì—…ì„ ì²˜ë¦¬
	- main ìŠ¤ë ˆë“œì™€ëŠ” ë‹¬ë¦¬ ë©”ëª¨ë¦¬ì— ì˜¬ë¼ì™”ë‹¤ê°€, ì‘ì—…ì´ ëë‚˜ê³  ë‚˜ë©´ ë©”ëª¨ë¦¬ì—ì„œ ìë™ìœ¼ë¡œ ì œê±°ë¨
```swift
// ë™ê¸°, sync
DispatchQueue.main.sync {}
DispatchQueue.global().sync {}

// ë¹„ë™ê¸°, async
DispatchQueue.main.async {}
DispatchQueue.global().async {}
```

### Main Thread
- ì•±ì˜ ê¸°ë³¸ì´ ë˜ëŠ” ìŠ¤ë ˆë“œ
- ì•±ì˜ ìƒëª…ì£¼ê¸°ì™€ ê°™ì€ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ”, ì•±ì´ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆì—ëŠ” ëŠ˜ ë©”ëª¨ë¦¬ì— ì˜¬ë¼ì™€ìˆëŠ” ê¸°ë³¸ ìŠ¤ë ˆë“œ
- ì¦‰ ë©”ì¸ìŠ¤ë ˆë“œê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ì•±ì€ ë™ì‘í•  ìˆ˜ ì—†ìŒ
- ë‹¤ë¥¸ ìŠ¤ë ˆë“œë“¤ì€ ëª¨ë‘ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œë¶€í„° í•„ìš”í•œ ë§Œí¼ íŒŒìƒë˜ëŠ” ê²ƒ
- ì „ì—­ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥
- global ìŠ¤ë ˆë“œë“¤ê³¼ëŠ” ë‹¤ë¥´ê²Œ Run Loopê°€ ìë™ìœ¼ë¡œ ì„¤ì •ë˜ê³  ì‹¤í–‰
- ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ë™ì‘í•˜ëŠ” Run Loopë¥¼ Main Run Loopë¼ê³  í•¨
- UI ì‘ì—…ì€ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œë§Œ ì‘ì—…í•  ìˆ˜ ìˆìŒ

### main.sync
- main Queueì˜ ì‘ì—…ì„ ë™ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ë©´ deadlockì— ë¹ ì§€ê²Œ ë¨
- ì‘ì—…ì´ ëë‚˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” syncì˜ íŠ¹ì„±ë•Œë¬¸ì— ë°œìƒ
- Main ìŠ¤ë ˆë“œëŠ” syncì˜ ì½”ë“œë¸”ëŸ­ì´ ìˆ˜í–‰ë˜ê¸°ë¥¼ ê¸°ë‹¤ë ¤ì•¼ í•˜ëŠ”ë°, ì´ ë•Œ sync ì½”ë“œ ë¸”ëŸ­ ì—­ì‹œ ë©ˆì¶°ë²„ë¦¬ëŠ” ê²ƒ
- queueë¥¼ blockí•˜ê³  syncì˜ ì½”ë“œë¸”ëŸ­ì˜ taskê°€ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼. í•˜ì§€ë§Œ queueëŠ” ì´ë¯¸ block ìƒíƒœê°€ ë˜ì—ˆê¸° ë•Œë¬¸ì— ì½”ë“œë¸”ëŸ­ì˜ taskëŠ” ì‹œì‘ì¡°ì°¨ í•  ìˆ˜ ì—†ìŒ.
- Custom Serial Queueì—ì„œëŠ” ê°€ëŠ¥
- ê³„ì†í•´ì„œ ì•±ì˜ ì´ë²¤íŠ¸ ì²˜ë¦¬ë¥¼ í•´ì•¼í•˜ëŠ” main threadê°€ sync í˜¸ì¶œì— ì˜í•´ ë©ˆì¶”ê²Œ ë˜ë©´ ì•ˆë˜ë‹ˆê¹Œ main queueì—ì„œë§Œ ì•ˆë˜ì§€ ì•Šì„ê¹Œ?

```swift
DispatchQueue.main.sync { /* error: error: Execution was interrupted, reason: EXC_BREAKPOINT (code=1, subcode=0x18011922c).
    The process has been left at the point where it was interrupted, use "thread return -x" to return to the state before expression evaluation. */
    for _ in 1...5 {
        print("ğŸ˜€ğŸ˜€ğŸ˜€ğŸ˜€ğŸ˜€")
        sleep(1)
    }
}
```

```swift
import Foundation

DispatchQueue.global().async {
    DispatchQueue.main.sync {
        for _ in 1...5 {
            print("ğŸ˜€ğŸ˜€ğŸ˜€ğŸ˜€ğŸ˜€")
            sleep(1)
        }
    }
}

for _ in 1...5 {
    print("ğŸ¥¶ğŸ¥¶ğŸ¥¶ğŸ¥¶ğŸ¥¶")
    sleep(2)
}
```

### DispatchWorkItem
- ì½”ë“œ ë¸”ëŸ­ì„ ìº¡ìŠí™” í•´ì¤„ ìˆ˜ ìˆìŒ
- íƒ€ì…ì„ ëª…ì‹œí•˜ëŠ” ë™ì‹œì— ë” ì§ê´€ì ì¸ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŒ
```swift
import Foundation

let red = DispatchWorkItem {
    for _ in 1...5 {
        print("ğŸ¥µğŸ¥µğŸ¥µğŸ¥µğŸ¥µ")
        sleep(1)
    }
}

let yellow = DispatchWorkItem {
    for _ in 1...5 {
        print("ğŸ˜€ğŸ˜€ğŸ˜€ğŸ˜€ğŸ˜€")
        sleep(1)
    }
}

let blue = DispatchWorkItem {
    for _ in 1...5 {
        print("ğŸ¥¶ğŸ¥¶ğŸ¥¶ğŸ¥¶ğŸ¥¶")
        sleep(2)
    }
}

DispatchQueue.main.async(execute: yellow)
DispatchQueue.global().sync(excute: blue)
```

### asyncAfter
- async ë©”ì„œë“œë¥¼ ì›í•˜ëŠ” ì‹œê°„ì— í˜¸ì¶œí•´ì¤„ ìˆ˜ ìˆëŠ” ë©”ì„œë“œ

### asyncAndWait
- ë¹„ë™ê¸° ì‘ì—…ì´ ëë‚˜ëŠ” ì‹œì ì„ ê¸°ë‹¤ë¦´ ìˆ˜ ìˆìŒ

---

> - ì°¸ê³ 
>   - [ì•¼ê³°ë‹·ë„· ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°](https://yagom.net/courses/ë™ì‹œì„±-í”„ë¡œê·¸ë˜ë°-concurrency-programming/lessons/ë™ì‹œì„±-í”„ë¡œê·¸ë˜ë°/topic/ì½”ì–´ì™€-ìŠ¤ë ˆë“œ/)
