# TIL 220328메모리구조

## 🔥학습 내용
### 메모리 구조
- 주기억장치 또는 컴퓨터 메모리는 컴퓨터에서 수치·명령·자료 등을 기억하는 컴퓨터 하드웨어 장치
- 프로그램이 실행되면 OS는 RAM에 해당 프로그램을 위한 공간을 할당
- 총 4가지 영역 Code, Data, Heap, Stack

![95016525-769c2780-068e-11eb-9c04-22da6a232278](https://user-images.githubusercontent.com/54234176/160425333-39d9aa92-ac4d-47fb-bb53-1c0fda6b4122.png)


#### Code 영역
- 소스코드가 기계어 형태로 저장되는 영역
- 컴파일 타임에 결정, 중간에 코드가 변경되지 않도록 Read-Only 형태로 저장
- 기계어는 0,1로만 이루어진 언어

#### Data 영역
- 전역변수, static 변수가 저장된다
- 프로그램 시작과 동시에 할당되고, 프로그램이 종료 되어야 메모리가 해제됨.
- 실행 도중 변수 값이 변경될 수 있으니 Read-Write로 지정
- singleton pattern 생각하면 될 듯.
- 지역변수는 stack 영역에 저장

#### Heap 영역
- 프로그래머가 할당/해제 하는 메모리 영역
- 프로그래머는 malloc, calloc으로 힙에 메모리를 할당할 수 있으며, 이를 동적 할당 이라고 함
- 사용하고 난 후에는 반드시 메모리 해제를 해줘야 함, 그렇지 않으면 memory leak이 발생
- Code, Data, Stack 중 유일하게 런타임 시에 결정되기 때문에 데이터의 크기가 확실하지 않을 때 사용
- Swift에서는 클래스 인스턴스, 클로저 같은 참조 타입의 값들이 모두 힙에 자동 할당 됨
- Swift는 ARC를 통해 힙에 할당된 메모리를 자동으로 해제해줌
- Stack 보다 상대적으로 느림 (할당, 해제, 손상, 경합등의 작업으로 속도 저하)

#### Stack 영역
- 함수 호출 시 함수의 지역변수, 매개변수, 리턴 값 등등이 저장되고, 함수가 종료되면 저장된 메모리도 해제
- 컴파일 타임에 결정되기 때문에 무한히 할당할 수 없음. 메모리 크기에 대한 제한이 있음.
- CPU가 스택 메모리를 효율적으로 구성하기 때문에 속도가 매우 빠름
- 메모리를 직접 해제 해주지 않아도 됨

#### Heap, Stack
- 힙과 스택은 사실 같은 메모리 영역을 공유함
- 힙 영역은 낮은 메모리 주소부터 할당 받고
- 스택 영역은 높은 메모리 주소부터 할당 받음
- 따라서 힙도 오버 플로우가 발생함

---

> - 참고
>   - [메모리 구조 - 소들이](https://babbab2.tistory.com/25)
